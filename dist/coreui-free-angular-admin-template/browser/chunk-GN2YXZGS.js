import{a as Pe}from"./chunk-YVX2SLF2.js";import{a as He,b as ze}from"./chunk-DJFYXFDX.js";import{b as $e}from"./chunk-VTW2WYXB.js";import{b as Ge}from"./chunk-MV7IGZFE.js";import{a as Ke,b as Me,c as Be,d as Ve,e as Le}from"./chunk-3CQKJCQS.js";import{Qa as Ce}from"./chunk-37HNLNO6.js";import"./chunk-GR7IJ7CP.js";import{a as ke}from"./chunk-LBW5AWSH.js";import"./chunk-UZYPASHM.js";import{c as xe,e as v,f as he,g as Se,h as be,k as Ae,l as De,m as Ee,n as Ie,o as Fe,p as Te,q as Ne,r as we,t as Oe,u as Ye,v as Re}from"./chunk-SVEOW7D2.js";import{$ as oe,A as X,B as J,Da as ye,G as Q,H as Z,L as ee,M as te,X as ie,Z as ne,_ as re,aa as ae,da as le,ea as ce,fa as pe,ga as me,ia as de,na as se,oa as ue,pa as _e,qa as ge,ra as ve,ta as fe,u as z,v as P,w as j,x as q,y as U,z as W}from"./chunk-37SJZKTR.js";import"./chunk-CZ6YIH4Q.js";import{A as H,d as B,e as V,k as L,x as G,z as $}from"./chunk-25OLHFVP.js";import{$b as h,Ac as M,Ob as p,Pb as n,Qb as t,Rb as s,Vb as x,Xa as l,bb as b,bc as d,hb as O,ja as f,ka as y,la as w,lc as A,nb as _,qc as a,rc as u,sc as g,tc as Y,uc as R,vc as k,wc as K}from"./chunk-AONHZWD2.js";import{a as T,b as N}from"./chunk-AQY5CCQG.js";function We(o,i){if(o&1){let e=x();n(0,"tr")(1,"td",26),a(2),t(),n(3,"td",26),a(4),t(),n(5,"td",26),a(6),t(),n(7,"td",26),a(8),t(),n(9,"td",26),a(10),t(),n(11,"td",26),a(12),t(),n(13,"td",26),a(14),t(),n(15,"td",26),a(16),t(),n(17,"td",26),a(18),t(),n(19,"td",26)(20,"button",27),h("click",function(){let c=f(e).$implicit,m=d(2);return y(m.ReceiptOpen(c))}),a(21," Receipt "),t()()()}if(o&2){let e=i.$implicit,r=i.index,c=d(2);l(2),u((c.page-1)*c.pageSize+r+1),l(2),u(e.yarnType),l(2),u(e.buyer),l(2),u(e.utilisationOrderNo),l(2),u(e.style),l(2),u(e.colour),l(2),u(e.lotNo||"-"),l(2),u(e.allocatedYarnKgs||"-"),l(2),u(e.unallocatedYarnKgs||"-"),l(2),p("cModalToggle","ReceiptModeal")}}function Xe(o,i){if(o&1){let e=x();n(0,"div",20)(1,"table",21)(2,"thead")(3,"tr")(4,"th",22),a(5,"Sl.No"),t(),n(6,"th",22),a(7,"Yarn Type"),t(),n(8,"th",22),a(9,"Buyer"),t(),n(10,"th",22),a(11,"Order No"),t(),n(12,"th",22),a(13,"Style"),t(),n(14,"th",22),a(15,"Color"),t(),n(16,"th",22),a(17,"Lot No"),t(),n(18,"th",22),a(19,"Allocated Yarn Kgs"),t(),n(20,"th",22),a(21,"Unallocated Yarn Kgs"),t(),n(22,"th",22),a(23,"Receipt"),t()()(),n(24,"tbody"),_(25,We,22,10,"tr",23),t()(),n(26,"div",24)(27,"ngb-pagination",25),K("pageChange",function(c){f(e);let m=d();return k(m.page,c)||(m.page=c),y(c)}),t()()()}if(o&2){let e=d();l(),p("striped",!0),l(24),p("ngForOf",e.yarnOrderAllocationsList==null?null:e.yarnOrderAllocationsList.slice((e.page-1)*e.pageSize,e.page*e.pageSize)),l(2),R("page",e.page),p("boundaryLinks",!0)("maxSize",3)("pageSize",e.pageSize)("collectionSize",e.yarnOrderAllocationsList.length)}}function Je(o,i){o&1&&(n(0,"div",28)(1,"c-card",29),s(2,"img",30),n(3,"c-card-body")(4,"h5",31),a(5,"No Data Found"),t(),n(6,"p",32),a(7," There are no yarn Order Allocations records available at the moment. "),t()()()())}function Qe(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e,r=d(2).$implicit;l(),g("Spin Challan : ",(e=r.get("spinningChallan"))==null?null:e.value)}}function Ze(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e,r=d(2).$implicit;l(),g("SBDL Challan : ",(e=r.get("scandexChallan"))==null?null:e.value)}}function et(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e,r=d(2).$implicit;l(),g("Bags/Ctn - nos : ",(e=r.get("BagsCtnNos"))==null?null:e.value)}}function tt(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e,r=d(2).$implicit;l(),g("Receipt Yarn Kgs : ",(e=r.get("receiptYarnKgs"))==null?null:e.value)}}function it(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e,r=d(2).$implicit;l(),g("Pending Receipts - Kgs : ",(e=r.get("pendingReceiptKgs"))==null?null:e.value)}}function nt(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e=i.ngIf;l(),Y(" Receipt Date: ",e.day,"/",e.month,"/",e.year," ")}}function rt(o,i){if(o&1&&(n(0,"mat-chip"),a(1),t()),o&2){let e,r=d(2).$implicit;l(),g(" Knit Factory :",(e=r.get("knitFactory"))==null?null:e.value," ")}}function ot(o,i){if(o&1){let e=x();n(0,"button",40),h("click",function(){f(e),d();let c=A(3);return y(c.toggleItem())}),n(1,"div")(2,"div")(3,"span"),a(4),t()(),n(5,"div"),_(6,Qe,2,1,"mat-chip",41)(7,Ze,2,1,"mat-chip",41)(8,et,2,1,"mat-chip",41)(9,tt,2,1,"mat-chip",41)(10,it,2,1,"mat-chip",41)(11,nt,2,3,"mat-chip",41)(12,rt,2,1,"mat-chip",41),t()()()}if(o&2){let e,r,c,m,D,E,I,F=d(),C=F.$implicit,qe=F.index,Ue=A(3);p("collapsed",!Ue.visible),l(4),g("Receipt No ",qe+1),l(2),p("ngIf",(e=C.get("spinningChallan"))==null?null:e.value),l(),p("ngIf",(r=C.get("scandexChallan"))==null?null:r.value),l(),p("ngIf",(c=C.get("BagsCtnNos"))==null?null:c.value),l(),p("ngIf",(m=C.get("receiptYarnKgs"))==null?null:m.value),l(),p("ngIf",(D=C.get("pendingReceiptKgs"))==null?null:D.value),l(),p("ngIf",(E=C.get("receiptDt"))==null?null:E.value),l(),p("ngIf",(I=C.get("knitFactory"))==null?null:I.value)}}function at(o,i){if(o&1&&(n(0,"option",62),a(1),t()),o&2){let e=i.$implicit;p("value",M(e.knitFty)),l(),g(" ",e.knitFty)}}function lt(o,i){if(o&1){let e=x();n(0,"div",42)(1,"div",43)(2,"div",44)(3,"c-input-group")(4,"span",45),a(5,"spin Challan"),t(),s(6,"input",46),t()(),n(7,"div",44)(8,"c-input-group")(9,"span",45),a(10,"SBDL Challan"),t(),s(11,"input",47),t()(),n(12,"div",44)(13,"c-input-group")(14,"div",48)(15,"div")(16,"span",45),a(17,"Receipt Date"),t()(),n(18,"div",49)(19,"div",50),s(20,"input",51,2),n(22,"button",52),h("click",function(){f(e);let c=A(21);return y(c.toggle())}),s(23,"i",53),t()()()()()()(),n(24,"div",43)(25,"div",44)(26,"c-input-group")(27,"span",45),a(28,"Knit Factory"),t(),n(29,"select",54)(30,"option"),a(31,"Select"),t(),_(32,at,2,3,"option",55),t()()(),n(33,"div",44)(34,"c-input-group")(35,"span",45),a(36,"Bags/Ctn - nos"),t(),s(37,"input",56),t()(),n(38,"div",44)(39,"c-input-group")(40,"span",45),a(41,"Receipt Yarn Kgs"),t(),s(42,"input",57),t()()(),n(43,"div",43)(44,"div",44)(45,"c-input-group")(46,"span",45),a(47,"Pending Receipt Kgs"),t(),s(48,"input",58),t()()(),n(49,"div",59)(50,"div",26)(51,"button",60),h("click",function(){f(e);let c=d().index,m=d(2);return y(m.removeReceiptItem(c))}),w(),s(52,"svg",61),t()()()()}if(o&2){let e=d(3);l(32),p("ngForOf",e.listKnit),l(20),p("cIcon",e.icons.cilXCircle)}}function ct(o,i){if(o&1&&(n(0,"div",36)(1,"c-accordion")(2,"c-accordion-item",37,1),_(4,ot,13,9,"ng-template",38)(5,lt,53,2,"ng-template",39),t()()()),o&2){let e=i.index;p("formGroupName",e),l(2),p("visible",!1)}}function pt(o,i){if(o&1&&(n(0,"div",33)(1,"div",34),_(2,ct,6,2,"div",35),t()()),o&2){let e=d();l(2),p("ngForOf",e.items.controls)}}function mt(o,i){o&1&&(n(0,"div",28)(1,"c-card",29),s(2,"img",30),n(3,"c-card-body")(4,"h5",31),a(5,"No Data Found"),t(),n(6,"p",32),a(7," There are no Receipt records available at the moment. "),t()()()())}function dt(o,i){if(o&1){let e=x();n(0,"button",63),h("click",function(){f(e);let c=d();return y(c.updateReceipt())}),a(1," Update changes "),t()}}var S=class S{constructor(i,e,r,c){this.router=i;this.route=e;this.fb=r;this.api=c;this.yarnOrderAllocationsList=[];this.page=1;this.pageSize=5;this.listKnit=[];this.orderAllocationId=0;this.icons={cilXCircle:Ce};this.colors=[{color:"light"}];this.yarnAllocatedYarnKgs=0;this.receiptForm=this.fb.group({yarnId:[],data:this.fb.array([])})}ngOnInit(){let i=this.route.snapshot.paramMap.get("EditLine");this.editId=i?parseInt(i,10):null,this.callEdit(this.editId),this.listKnitFty()}convertNgbDateStruct(i){let e=new Date(i);return{year:e.getUTCFullYear(),month:e.getUTCMonth()+1,day:e.getUTCDate()}}formatDateValue(i){if(!i)return null;if(i.year&&i.month&&i.day){let e=i.year,r=String(i.month).padStart(2,"0"),c=String(i.day).padStart(2,"0");return`${e}-${r}-${c}`}if(i instanceof Date){let e=i.getFullYear(),r=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${e}-${r}-${c}`}return i}listKnitFty(){this.api.GetApi("/knitapi/knit-factory").subscribe(i=>{this.listKnit=i.factorys})}callEdit(i){this.api.GetApi(`/yarnapi/yarn/${i}`).subscribe(e=>{this.yarnOrderAllocationsList=e.yarn_order_allocations,this.yarnAllData=e})}get items(){return this.receiptForm.get("data")}AddReceipt(){let i=this.fb.group({id:[null],yarnOrderId:[null,[v.required]],spinningChallan:[null,[v.required]],scandexChallan:[null,[v.required]],receiptDt:[null,[v.required]],knitFactory:[null,[v.required]],BagsCtnNos:[null,[v.required]],receiptYarnKgs:[null,[v.required]],pendingReceiptKgs:[null,[v.required]]});this.items.push(i),i.get("receiptYarnKgs")?.valueChanges.subscribe(()=>{this.calculateDiff()})}removeReceiptItem(i){this.items.removeAt(i)}calculateDiff(){let i=this.yarnAllocatedYarnKgs;this.receiptForm.get("data").controls.forEach(e=>{let r=e;if(r instanceof be){let c=parseFloat(r.get("receiptYarnKgs")?.value)||0,m=null;c>0&&(m=i-c,i=m),r.patchValue({pendingReceiptKgs:m},{emitEvent:!1})}})}ReceiptOpen(i){this.orderAllocationId=i.id,this.api.GetApi(`/yarnapi/yarnlclineForReceipt?id=${this.yarnAllData?.yarn[0]?.id}&lineId=${this.orderAllocationId}`).subscribe(e=>{let r=e.lcData;this.yarnAllocatedYarnKgs=i?.allocatedYarnKgs;let c=this.receiptForm.get("data");c.clear(),r.forEach(m=>{let D=this.fb.group({id:m.id,yarnOrderId:this.orderAllocationId,spinningChallan:m.spinningChallan,scandexChallan:m.scandexChallan,receiptDt:this.convertNgbDateStruct(m.receiptDt),knitFactory:m.knitFactory,BagsCtnNos:m.BagsCtnNos,receiptYarnKgs:m.receiptYarnKgs,pendingReceiptKgs:m.pendingReceiptKgs?m.pendingReceiptKgs:i?.allocatedYarnKgs-m.receiptYarnKgs});c.push(D)})})}updateReceipt(){let i=this.receiptForm.value,e={yarnId:this.yarnAllData?.yarn[0]?.id,data:i.data.map(r=>N(T({},r),{receiptDt:this.formatDateValue(r.receiptDt),yarnOrderId:this.orderAllocationId}))};this.api.PostApiWithHeader("/yarnapi/yarn_receipts_lines",e).subscribe(r=>{r.success===!0?this.api.showSuccess("Updated Successfully !!! ","Saved"):this.api.showError("Not saved","Error")})}};S.\u0275fac=function(e){return new(e||S)(b($),b(G),b(Oe),b(ke))},S.\u0275cmp=O({type:S,selectors:[["app-yarn-order-allocation"]],decls:31,vars:8,consts:[["ReceiptModeal",""],["item0","cAccordionItem"],["d01","ngbDatepicker"],["fluid",""],[3,"routerLink"],[1,"ms-auto"],["style","overflow-x: auto; width: 100%;","class","table-responsive",4,"ngIf"],["class","d-flex justify-content-center align-items-center","style","height: 100vh; width: 100%;",4,"ngIf"],["id","ReceiptModeal","backdrop","static","scrollable","",3,"fullscreen"],["fluid","",1,"d-flex","justify-content-between","align-items-center","py-2"],["routerLink","/",1,"fw-bold","fs-5"],["cButton","","color","primary","variant","outline",3,"click"],[1,"cil-plus","me-1"],["cButtonClose","",3,"cModalToggle"],["fluid","",3,"formGroup"],[1,"container"],["class","row g-5",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"w-100","text-center"],["cButton","","color","primary",3,"click",4,"ngIf"],[1,"table-responsive",2,"overflow-x","auto","width","100%"],["bordered","","cTable","",1,"table","table-hover",3,"striped"],["scope","col",1,"text-center"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center"],[3,"pageChange","page","boundaryLinks","maxSize","pageSize","collectionSize"],[1,"text-center"],[1,"btn","btn-sm","btn-outline-primary",3,"click","cModalToggle"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100vh","width","100%"],[2,"max-width","400px","text-align","center"],["cCardImg","top","src","../../../../assets/No data-amico.svg","alt","No Data"],["cCardTitle",""],["cCardText",""],[1,"row","g-5"],["formArrayName","data"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[3,"visible"],["cTemplateId","accordionHeaderTemplate"],["cTemplateId","accordionBodyTemplate"],["cAccordionButton","",3,"click","collapsed"],[4,"ngIf"],[1,"accordion-body"],[1,"row","g-3","mb-4"],[1,"col-sm"],["cInputGroupText",""],["aria-label","Yarn Type","cFormControl","","type","text","formControlName","spinningChallan"],["aria-label","SBDL Challan","cFormControl","","type","text","formControlName","scandexChallan"],[2,"display","flex","flex-direction","row","width","inherit"],[2,"width","100%"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","d01","ngbDatepicker","","container","body","formControlName","receiptDt",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"cil-calendar"],["aria-label","Knit Factory","cSelect","","formControlName","knitFactory"],[3,"value",4,"ngFor","ngForOf"],["aria-label","Bags/Ctn - nos","cFormControl","","type","number","formControlName","BagsCtnNos"],["aria-label","Receipt Yarn Kgs","cFormControl","","type","number","formControlName","receiptYarnKgs"],["aria-label","Pending Receipt Kgs","cFormControl","","type","text","formControlName","pendingReceiptKgs","readonly",""],[1,"row","g-3","mb-12"],["cButton","","color","link",2,"color","red",3,"click"],["size","xl","title","List Icon",3,"cIcon"],[3,"value"],["cButton","","color","primary",3,"click"]],template:function(e,r){if(e&1){let c=x();n(0,"c-header")(1,"c-container",3)(2,"c-header-brand",4),a(3,"Order Allocation List"),t(),s(4,"c-header-nav",5),t(),s(5,"c-header-divider"),n(6,"c-container",3),_(7,Xe,28,7,"div",6)(8,Je,8,0,"div",7),t()(),n(9,"c-modal",8,0)(11,"c-modal-header")(12,"c-container",9)(13,"c-header-brand",10),a(14," Receipt "),t(),n(15,"c-header-nav")(16,"c-nav-item")(17,"button",11),h("click",function(){return f(c),y(r.AddReceipt())}),s(18,"i",12),a(19," Add "),t(),s(20,"button",13),t()()()(),n(21,"c-modal-body")(22,"div")(23,"c-header")(24,"c-container",14)(25,"div",15),_(26,pt,3,1,"div",16)(27,mt,8,0,"div",7),t()()()()(),n(28,"c-modal-footer",17)(29,"div",18),_(30,dt,2,0,"button",19),t()()()}if(e&2){let c=A(10);l(7),p("ngIf",((r.yarnOrderAllocationsList==null?null:r.yarnOrderAllocationsList.length)||0)>0),l(),p("ngIf",((r.yarnOrderAllocationsList==null?null:r.yarnOrderAllocationsList.length)||0)===0),l(),p("fullscreen",!0),l(11),p("cModalToggle",c.id),l(4),p("formGroup",r.receiptForm),l(2),p("ngIf",((r.items==null?null:r.items.length)||0)>0),l(),p("ngIf",((r.items==null?null:r.items.length)||0)===0),l(3),p("ngIf",((r.items==null?null:r.items.length)||0)>0)}},dependencies:[H,Q,Z,te,ee,X,de,le,ce,pe,me,Pe,P,z,ae,se,j,ye,J,ue,fe,ge,ve,_e,Re,Ne,we,xe,Ae,Te,he,Se,De,Fe,Ee,Ie,ne,re,oe,ie,L,B,V,$e,Ge,Le,Ve,Ke,Be,Me,Ye,q,U,W,ze,He],encapsulation:2});var je=S;export{je as YarnOrderAllocationComponent};
