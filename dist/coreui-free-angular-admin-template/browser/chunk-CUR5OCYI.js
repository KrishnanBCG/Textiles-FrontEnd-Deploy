import{a as Be}from"./chunk-YVX2SLF2.js";import{a as Re,b as Me}from"./chunk-DJFYXFDX.js";import{b as Ge}from"./chunk-VTW2WYXB.js";import{b as $e}from"./chunk-MV7IGZFE.js";import{a as we,b as Ve,c as Oe,e as Ke}from"./chunk-3CQKJCQS.js";import{Qa as ge}from"./chunk-37HNLNO6.js";import"./chunk-GR7IJ7CP.js";import{a as ke}from"./chunk-LBW5AWSH.js";import"./chunk-UZYPASHM.js";import{b as fe,c as he,e as _,f as Ce,g as xe,h as D,k as be,l as Se,m as Le,n as Ye,o as Te,p as Ee,q as Ne,r as Fe,t as Ae,u as De,v as Ie}from"./chunk-SVEOW7D2.js";import{$ as re,A as W,B as z,G as J,H as Q,L as Z,M as ee,X as te,Z as ne,_ as ie,aa as oe,da as ae,ea as le,fa as ce,ga as pe,ia as me,na as se,oa as de,pa as ue,qa as _e,ra as ve,ta as ye,u as q,v as H,w as j,x as U,y as P,z as X}from"./chunk-37SJZKTR.js";import"./chunk-CZ6YIH4Q.js";import{A as B,d as K,e as $,k as G,x as R,z as M}from"./chunk-25OLHFVP.js";import{$b as f,Ac as Y,Ob as p,Pb as o,Qb as i,Rb as u,Vb as S,Xa as c,bb as N,bc as s,hb as V,ja as y,ka as g,la as A,lc as x,nb as h,qc as l,rc as O,sc as v,tc as I}from"./chunk-AONHZWD2.js";import{a as k,b as w}from"./chunk-AQY5CCQG.js";function Ue(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.spinfty)),c(),v("",e.spinfty," ")}}function Pe(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Yarn Type : ",(e=n.get("yarnType"))==null?null:e.value)}}function Xe(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("LC Yarn Kgs : ",(e=n.get("lcYarnKgs"))==null?null:e.value)}}function We(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Yarn Rate : ",(e=n.get("yarnRate"))==null?null:e.value)}}function ze(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("LC Value : ",(e=n.get("yarnValue"))==null?null:e.value)}}function Je(r,t){if(r&1){let e=S();o(0,"button",53),f("click",function(){y(e),s();let a=x(3);return g(a.toggleItem())}),o(1,"div")(2,"div")(3,"span"),l(4),i()(),o(5,"div"),h(6,Pe,2,1,"mat-chip",54)(7,Xe,2,1,"mat-chip",54)(8,We,2,1,"mat-chip",54)(9,ze,2,1,"mat-chip",54),i()()()}if(r&2){let e,n,a,m,d=s(),C=d.$implicit,b=d.index,T=x(3);p("collapsed",!T.visible),c(4),v("Yarn Line ",b+1),c(2),p("ngIf",(e=C.get("yarnType"))==null?null:e.value),c(),p("ngIf",(n=C.get("lcYarnKgs"))==null?null:n.value),c(),p("ngIf",(a=C.get("yarnRate"))==null?null:a.value),c(),p("ngIf",(m=C.get("yarnValue"))==null?null:m.value)}}function Qe(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.yarnType)),c(),O(e.yarnType)}}function Ze(r,t){if(r&1){let e=S();o(0,"div",13)(1,"div",14)(2,"div",15)(3,"c-input-group")(4,"span",16),l(5,"Yarn Type"),i(),o(6,"select",55)(7,"option"),l(8,"Select"),i(),h(9,Qe,2,3,"option",18),i()()(),o(10,"div",15)(11,"c-input-group")(12,"span",16),l(13,"LC Yarn Kgs"),i(),u(14,"input",56),i()(),o(15,"div",15)(16,"c-input-group")(17,"span",16),l(18,"Yarn Rate"),i(),u(19,"input",57),i()(),o(20,"div",15)(21,"c-input-group")(22,"span",16),l(23,"LC Value"),i(),u(24,"input",58),i()()(),o(25,"div",59)(26,"div",60)(27,"button",61),f("click",function(){y(e);let a=s().index,m=s();return g(m.lotCheckOpen(a))}),l(28,"Lot Check"),i(),o(29,"button",61),f("click",function(){y(e);let a=s().index,m=s();return g(m.orderAllocationOpen(a))}),l(30,"Order Allocation"),i()()(),o(31,"div",59)(32,"div",62)(33,"button",63),f("click",function(){y(e);let a=s().index,m=s();return g(m.removeItem(a))}),A(),u(34,"svg",64),i()()()()}if(r&2){let e=s(2);c(9),p("ngForOf",e.yarnTypeList),c(18),p("cModalToggle","lotCheckModal"),c(2),p("cModalToggle","orderAllocationModal"),c(5),p("cIcon",e.icons.cilXCircle)}}function et(r,t){if(r&1&&(o(0,"div",49)(1,"c-accordion")(2,"c-accordion-item",50,4),h(4,Je,10,6,"ng-template",51)(5,Ze,35,4,"ng-template",52),i()()()),r&2){let e=t.index;p("formGroupName",e),c(2),p("visible",!1)}}function tt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Yarn Type : ",(e=n.get("yarnType"))==null?null:e.value)}}function nt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("lot No : ",(e=n.get("lotNo"))==null?null:e.value)}}function it(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e=t.ngIf;c(),I(" Sample Date: ",e.day,"/",e.month,"/",e.year," ")}}function rt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e=t.ngIf;c(),I(" Result Date: ",e.day,"/",e.month,"/",e.year," ")}}function ot(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v(" Status :",(e=n.get("acceptRejectStatus"))!=null&&e.value?"Accept":"Reject"," ")}}function at(r,t){if(r&1){let e=S();o(0,"button",53),f("click",function(){y(e),s();let a=x(3);return g(a.toggleItem())}),o(1,"div")(2,"div")(3,"span"),l(4),i()(),o(5,"div"),h(6,tt,2,1,"mat-chip",54)(7,nt,2,1,"mat-chip",54)(8,it,2,3,"mat-chip",54)(9,rt,2,3,"mat-chip",54)(10,ot,2,1,"mat-chip",54),i()()()}if(r&2){let e,n,a,m,d,C=s(),b=C.$implicit,T=C.index,F=x(3);p("collapsed",!F.visible),c(4),v("Lot Check Line ",T+1),c(2),p("ngIf",(e=b.get("yarnType"))==null?null:e.value),c(),p("ngIf",(n=b.get("lotNo"))==null?null:n.value),c(),p("ngIf",(a=b.get("sampleDate"))==null?null:a.value),c(),p("ngIf",(m=b.get("resultDate"))==null?null:m.value),c(),p("ngIf",(d=b.get("acceptRejectStatus"))==null?null:d.value)}}function lt(r,t){if(r&1){let e=S();o(0,"div",13)(1,"div",14)(2,"div",15)(3,"c-input-group")(4,"span",16),l(5,"Yarn Type"),i(),u(6,"input",65),i()(),o(7,"div",15)(8,"c-input-group")(9,"span",16),l(10,"Lot no"),i(),u(11,"input",66),i()(),o(12,"div",15)(13,"c-input-group")(14,"div",19)(15,"div")(16,"span",16),l(17,"Sample Date"),i()(),o(18,"div",20)(19,"div",21),u(20,"input",67,1),o(22,"button",23),f("click",function(){y(e);let a=x(21);return g(a.toggle())}),u(23,"i",24),i()()()()()()(),o(24,"div",14)(25,"div",15)(26,"c-input-group")(27,"div",19)(28,"div")(29,"span",16),l(30,"Result Date"),i()(),o(31,"div",20)(32,"div",21),u(33,"input",68,5),o(35,"button",23),f("click",function(){y(e);let a=x(34);return g(a.toggle())}),u(36,"i",24),i()()()()()(),o(37,"div",15)(38,"c-input-group")(39,"span",16),l(40,"Results"),i(),u(41,"textarea",69),i()(),o(42,"div",70)(43,"c-input-group")(44,"div",71),u(45,"input",72),i(),o(46,"span",16),l(47,"Accept / Reject"),i()()()(),o(48,"div",59)(49,"div",62)(50,"button",63),f("click",function(){y(e);let a=s().index,m=s(2);return g(m.removeLotCheckItem(a))}),A(),u(51,"svg",64),i()()()()}if(r&2){let e=s(3);c(51),p("cIcon",e.icons.cilXCircle)}}function ct(r,t){if(r&1&&(o(0,"div",49)(1,"c-accordion")(2,"c-accordion-item",50,4),h(4,at,11,7,"ng-template",51)(5,lt,52,1,"ng-template",52),i()()()),r&2){let e=t.index;p("formGroupName",e),c(2),p("visible",!1)}}function pt(r,t){if(r&1&&(o(0,"div",12)(1,"div",33),h(2,ct,6,2,"div",34),i()()),r&2){let e=s();c(2),p("ngForOf",e.itemsLotCheck.controls)}}function mt(r,t){r&1&&(o(0,"div",73)(1,"c-card",74),u(2,"img",75),o(3,"c-card-body")(4,"h5",76),l(5,"No Data Found"),i(),o(6,"p",77),l(7," There are no LotCheck records available at the moment. "),i()()()())}function st(r,t){if(r&1){let e=S();o(0,"button",36),f("click",function(){y(e);let a=s();return g(a.updateLotCheck())}),l(1," Update changes "),i()}}function dt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Yarn Type : ",(e=n.get("yarnType"))==null?null:e.value)}}function ut(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Buyer : ",(e=n.get("buyer"))==null?null:e.value)}}function _t(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Order No : ",(e=n.get("utilisationOrderNo"))==null?null:e.value)}}function vt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Style : ",(e=n.get("style"))==null?null:e.value)}}function yt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Color : ",(e=n.get("colour"))==null?null:e.value)}}function gt(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Lot No : ",(e=n.get("lcNo"))==null?null:e.value)}}function ft(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Allocated Yarn Kgs : ",(e=n.get("allocatedYarnKgs"))==null?null:e.value)}}function ht(r,t){if(r&1&&(o(0,"mat-chip"),l(1),i()),r&2){let e,n=s(2).$implicit;c(),v("Unallocated Yarn Kgs : ",(e=n.get("unallocatedYarnKgs"))==null?null:e.value)}}function Ct(r,t){if(r&1){let e=S();o(0,"button",53),f("click",function(){y(e),s();let a=x(3);return g(a.toggleItem())}),o(1,"div")(2,"div")(3,"span"),l(4),i()(),o(5,"div"),h(6,dt,2,1,"mat-chip",54)(7,ut,2,1,"mat-chip",54)(8,_t,2,1,"mat-chip",54)(9,vt,2,1,"mat-chip",54)(10,yt,2,1,"mat-chip",54)(11,gt,2,1,"mat-chip",54)(12,ft,2,1,"mat-chip",54)(13,ht,2,1,"mat-chip",54),i()()()}if(r&2){let e,n,a,m,d,C,b,T,F=s(),L=F.$implicit,He=F.index,je=x(3);p("collapsed",!je.visible),c(4),v("Order Allocation Line ",He+1),c(2),p("ngIf",(e=L.get("yarnType"))==null?null:e.value),c(),p("ngIf",(n=L.get("buyer"))==null?null:n.value),c(),p("ngIf",(a=L.get("utilisationOrderNo"))==null?null:a.value),c(),p("ngIf",(m=L.get("style"))==null?null:m.value),c(),p("ngIf",(d=L.get("colour"))==null?null:d.value),c(),p("ngIf",(C=L.get("lcNo"))==null?null:C.value),c(),p("ngIf",(b=L.get("allocatedYarnKgs"))==null?null:b.value),c(),p("ngIf",(T=L.get("unallocatedYarnKgs"))==null?null:T.value)}}function xt(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.buyer)),c(),v(" ",e.buyer)}}function bt(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.orderNO)),c(),v(" ",e.orderNO)}}function St(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.style)),c(),v(" ",e.style)}}function Lt(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.color)),c(),v(" ",e.color)}}function Yt(r,t){if(r&1&&(o(0,"option",48),l(1),i()),r&2){let e=t.$implicit;p("value",Y(e.lotNo)),c(),v(" ",e.lotNo)}}function Tt(r,t){if(r&1){let e=S();o(0,"div",13)(1,"div",14)(2,"div",15)(3,"c-input-group")(4,"span",16),l(5,"Yarn Type"),i(),u(6,"input",65),i()(),o(7,"div",15)(8,"c-input-group")(9,"span",16),l(10,"Buyer"),i(),o(11,"select",78),f("change",function(){y(e);let a=s().index,m=s(2);return g(m.loadOrderNo(a))}),o(12,"option"),l(13,"Select"),i(),h(14,xt,2,3,"option",18),i()()(),o(15,"div",15)(16,"c-input-group")(17,"span",16),l(18,"Order No"),i(),o(19,"select",79),f("change",function(){y(e);let a=s().index,m=s(2);return g(m.loadStyle(a))}),o(20,"option"),l(21,"Select"),i(),h(22,bt,2,3,"option",18),i()()()(),o(23,"div",14)(24,"div",15)(25,"c-input-group")(26,"span",16),l(27,"Style"),i(),o(28,"select",80),f("change",function(){y(e);let a=s().index,m=s(2);return g(m.loadColor(a))}),o(29,"option"),l(30,"Select"),i(),h(31,St,2,3,"option",18),i()()(),o(32,"div",15)(33,"c-input-group")(34,"span",16),l(35,"Color"),i(),o(36,"select",81)(37,"option"),l(38,"Select"),i(),h(39,Lt,2,3,"option",18),i()()(),o(40,"div",15)(41,"c-input-group")(42,"span",16),l(43,"Lot No"),i(),o(44,"select",82)(45,"option"),l(46,"Select"),i(),h(47,Yt,2,3,"option",18),i()()()(),o(48,"div",14)(49,"div",15)(50,"c-input-group")(51,"span",16),l(52,"Allocated Yarn Kgs"),i(),u(53,"input",83),i()(),o(54,"div",15)(55,"c-input-group")(56,"span",16),l(57,"Unallocated Yarn Kgs"),i(),u(58,"input",84),i()()(),o(59,"div",59)(60,"div",62)(61,"button",63),f("click",function(){y(e);let a=s().index,m=s(2);return g(m.removeOrderAllocationItem(a))}),A(),u(62,"svg",64),i()()()()}if(r&2){let e,n,a,m=s().$implicit,d=s(2);c(14),p("ngForOf",d.listBuyer),c(8),p("ngForOf",(e=m.get("orderNoList"))==null?null:e.value),c(9),p("ngForOf",(n=m.get("styleList"))==null?null:n.value),c(8),p("ngForOf",(a=m.get("colorList"))==null?null:a.value),c(8),p("ngForOf",d.lotCheckDropList),c(15),p("cIcon",d.icons.cilXCircle)}}function Et(r,t){if(r&1&&(o(0,"div",49)(1,"c-accordion")(2,"c-accordion-item",50,4),h(4,Ct,14,10,"ng-template",51)(5,Tt,63,6,"ng-template",52),i()()()),r&2){let e=t.index;p("formGroupName",e),c(2),p("visible",!1)}}function Nt(r,t){if(r&1&&(o(0,"div",12)(1,"div",33),h(2,Et,6,2,"div",34),i()()),r&2){let e=s();c(2),p("ngForOf",e.itemsOrderAllocation.controls)}}function Ft(r,t){r&1&&(o(0,"div",73)(1,"c-card",74),u(2,"img",75),o(3,"c-card-body")(4,"h5",76),l(5,"No Data Found"),i(),o(6,"p",77),l(7," There are no Order Allocation records available at the moment. "),i()()()())}function At(r,t){if(r&1){let e=S();o(0,"button",36),f("click",function(){y(e);let a=s();return g(a.updateOrderAllocation())}),l(1," Update changes "),i()}}var E=class E{constructor(t,e,n,a){this.router=t;this.fb=e;this.api=n;this.route=a;this.filterYarnType="";this.icons={cilXCircle:ge};this.colors=[{color:"light"}];this.yarnLineId=0;this.yarnTypeName="";this.yarnTypeId=0;this.lotCheckList=[];this.lotCheckDropList=[];this.orderAllocationList=[];this.listBuyer=[];this.YarnKgs=0;this.newYarnForm=this.fb.group({id:[null],spinner:[null,[_.required]],lcDate:[null,[_.required]],lcNo:[null,[_.required]],pi:[null,[_.required]],piDate:[null,[_.required]],lcYarnKgs:[null,[_.required]],lcValue:[null,[_.required]],yarnStatus:[null,[_.required]],data:this.fb.array([])}),this.lotCheckForm=this.fb.group({yarnId:[null],data:this.fb.array([])}),this.orderAllocationForm=this.fb.group({yarnId:[null],data:this.fb.array([])})}get items(){return this.newYarnForm.get("data")}AddLines(){let t=this.fb.group({id:[null],yarnType:[null,[_.required]],lcYarnKgs:[null,[_.required]],yarnRate:[null,[_.required]],yarnValue:[null,[_.required]]});this.items.push(t),t.get("lcYarnKgs")?.valueChanges.subscribe(()=>{this.calculateDiff01()}),t.get("yarnRate")?.valueChanges.subscribe(()=>{this.calculateDiff02()}),t.get("yarnValue")?.valueChanges.subscribe(()=>{this.calculateDiff01()})}removeItem(t){this.items.removeAt(t)}calculateDiff01(){let t=0,e=0;this.items.controls.forEach(n=>{let a=n;if(a instanceof D){let m=parseFloat(a.get("lcYarnKgs")?.value)||0,d=parseFloat(a.get("yarnValue")?.value)||0;t+=m,e+=d,this.newYarnForm.get("lcYarnKgs")?.setValue(t),this.newYarnForm.get("lcValue")?.setValue(e)}})}calculateDiff02(){let t=0,e=0;this.items.controls.forEach(n=>{let a=n;if(a instanceof D){let m=parseFloat(a.get("lcYarnKgs")?.value)||0,d=parseFloat(a.get("yarnRate")?.value)||0,C=m*d;a.get("yarnValue")?.setValue(C)}})}ngOnInit(){this.loadSpinFtyList(),this.loadYarnTypeList();let t=this.route.snapshot.paramMap.get("EditLine");this.editId=t?parseInt(t,10):null,this.callEdit(this.editId)}loadSpinFtyList(){this.api.GetApi("/yarnapi/spinfty").subscribe(t=>{this.spinFtyList=t.buyers})}loadYarnTypeList(){this.api.GetApi(`/mastersapi/yarn-type-master-filter?yarnType=${this.filterYarnType}`).subscribe(t=>{this.allyarnTypeList=t.yarnType}),this.api.GetApi("/yarnapi/yarn_type").subscribe(t=>{this.yarnTypeList=t.types})}dateFormat(t){let e=t==="lcDate"?this.newYarnForm.get("lcDate")?.value:this.newYarnForm.get("piDate")?.value;if(!e)return null;let n=e.year,a=String(e.month).padStart(2,"0"),m=String(e.day).padStart(2,"0");return`${n}-${a}-${m}`}convertNgbDateStruct(t){let e=new Date(t);return{year:e.getUTCFullYear(),month:e.getUTCMonth()+1,day:e.getUTCDate()}}callEdit(t){this.api.GetApi(`/yarnapi/yarn/${t}`).subscribe(e=>{this.loadBuyer(),this.yarnHeaderList=e.yarn[0],this.lotCheckDropList=e.lotNo,this.newYarnForm.patchValue({id:e.yarn[0].id,spinner:e.yarn[0].spinner,lcDate:this.convertNgbDateStruct(e.yarn[0].lcDate),lcNo:e.yarn[0].lcNo,pi:e.yarn[0].pi,piDate:this.convertNgbDateStruct(e.yarn[0].piDate),lcYarnKgs:parseInt(e.yarn_lc_total[0].lctotal),lcValue:parseInt(e.yarn[0].lcValue),yarnStatus:e.yarn[0].yarnStatus});let n=this.newYarnForm.get("data");n.clear(),e.yarn_lc_lines.forEach(a=>{let m=this.fb.group({id:a.id,yarnType:a.yarnType,lcYarnKgs:parseInt(a.lcYarnKgs),yarnRate:parseInt(a.yarnRate),yarnValue:parseInt(a.yarnValue)});n.push(m)})})}updateYarn(){this.newYarnForm.controls.lcDate.setValue(this.dateFormat("lcDate")),this.newYarnForm.controls.piDate.setValue(this.dateFormat("piDate")),this.api.PostApiWithHeader("/yarnapi/yarn",this.newYarnForm.value).subscribe(t=>{t.success===!0?(this.newYarnForm.reset(),this.api.showSuccess("Updated Successfully !!! ","Saved"),this.router.navigateByUrl("/pages/yarn/yarnList")):this.api.showError("Not saved","Error")})}formatDateValue(t){if(!t)return null;if(t.year&&t.month&&t.day){let e=t.year,n=String(t.month).padStart(2,"0"),a=String(t.day).padStart(2,"0");return`${e}-${n}-${a}`}if(t instanceof Date){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${a}`}return t}lotCheckOpen(t){let n=this.newYarnForm.get("data").at(t);this.yarnLineId=n.value.id,this.yarnTypeName=n.value.yarnType,this.yarnTypeId=this.allyarnTypeList.find(a=>a.yarntype===this.yarnTypeName)?.id,this.api.GetApi(`/yarnapi/yarnlclineForLot?id=${this.yarnHeaderList?.id}&lineId=${this.yarnLineId}`).subscribe(a=>{this.lotCheckList=a.lcData;let m=this.lotCheckForm.get("data");m.clear(),this.lotCheckList.forEach(d=>{let C=this.fb.group({id:d.id,yarnLineId:this.yarnLineId,yarnType:d.yarnType,lotNo:d.lotNo,sampleDate:this.convertNgbDateStruct(d.sampleDate),resultDate:this.convertNgbDateStruct(d.resultDate),checkResults:d.checkResults,acceptRejectStatus:d.acceptRejectStatus});m.push(C)})})}get itemsLotCheck(){return this.lotCheckForm.get("data")}AddLotCheck(){let t=this.fb.group({id:null,yarnLineId:[this.yarnLineId,[_.required]],yarnType:[this.yarnTypeName,[_.required]],lotNo:[null,[_.required]],sampleDate:[null,[_.required]],resultDate:[null,[_.required]],checkResults:[null,[_.required]],acceptRejectStatus:[null,[_.required]]});this.itemsLotCheck.push(t)}removeLotCheckItem(t){this.itemsLotCheck.removeAt(t)}updateLotCheck(){let t=this.lotCheckForm.value,e={yarnId:this.yarnHeaderList?.id,data:t.data.map(n=>w(k({},n),{sampleDate:this.formatDateValue(n.sampleDate),resultDate:this.formatDateValue(n.resultDate)}))};this.api.PostApiWithHeader("/yarnapi/yarn_lot_check",e).subscribe(n=>{n.success===!0?this.api.showSuccess("Updated Successfully !!! ","Saved"):this.api.showError("Not saved","Error")})}loadBuyer(){this.api.GetApi("/filtersapi/buyers").subscribe(t=>{this.listBuyer=t?.buyers})}orderAllocationOpen(t){let n=this.newYarnForm.get("data").at(t);this.yarnLineId=n.value.id,this.yarnTypeName=n.value.yarnType,this.YarnKgs=n.value.lcYarnKgs,this.yarnTypeId=this.allyarnTypeList.find(a=>a.yarntype===this.yarnTypeName)?.id,this.api.GetApi(`/yarnapi/yarnlclineForOrder?id=${this.yarnHeaderList?.id}&lineId=${this.yarnLineId}`).subscribe(a=>{this.orderAllocationList=a.lcData;let m=this.orderAllocationForm.get("data");m.clear(),this.orderAllocationList.forEach((d,C)=>{let b=this.fb.group({id:d.id,yarnLineId:this.yarnLineId,yarnType:d.yarnType,buyer:d.buyer,utilisationOrderNo:d.utilisationOrderNo,style:d.style,colour:d.colour,lotNo:d.lotNo,allocatedYarnKgs:d.allocatedYarnKgs,unallocatedYarnKgs:d.unallocatedYarnKgs,orderNoList:[[]],styleList:[[]],colorList:[[]]});m.push(b),this.loadOrderNo(C),this.loadStyle(C),this.loadColor(C)})})}get itemsOrderAllocation(){return this.orderAllocationForm.get("data")}AddOrderAllocation(){let t=this.fb.group({id:null,yarnLineId:[this.yarnLineId,[_.required]],yarnType:[this.yarnTypeName,[_.required]],buyer:[null,[_.required]],utilisationOrderNo:[null,[_.required]],style:[null,[_.required]],colour:[null,[_.required]],lotNo:[null,[_.required]],allocatedYarnKgs:[null,[_.required]],unallocatedYarnKgs:[null],orderNoList:[[]],styleList:[[]],colorList:[[]]});this.itemsOrderAllocation.push(t),t.get("allocatedYarnKgs")?.valueChanges.subscribe(()=>{this.calculateDiff()})}calculateDiff(){let t=this.YarnKgs;this.orderAllocationForm.get("data").controls.forEach(e=>{let n=e;if(n instanceof D){let a=parseFloat(n.get("allocatedYarnKgs")?.value)||0,m=t-a;n.patchValue({unallocatedYarnKgs:m},{emitEvent:!1}),t=m}})}removeOrderAllocationItem(t){this.itemsOrderAllocation.removeAt(t)}updateOrderAllocation(){this.orderAllocationForm.controls.yarnId.setValue(this.yarnHeaderList?.id),this.api.PostApiWithHeader("/yarnapi/yarn_order_allocations",this.orderAllocationForm.value).subscribe(t=>{t.success===!0?this.api.showSuccess("Updated Successfully !!! ","Saved"):this.api.showError("Not saved","Error")})}loadOrderNo(t){let n=this.orderAllocationForm.get("data").at(t),a=n.get("buyer")?.value;this.api.GetApi(`/filtersapi/buyers-orders?buyer=${a}&`).subscribe(m=>{n.get("orderNoList")?.setValue(m.orders||[])})}loadStyle(t){let n=this.orderAllocationForm.get("data").at(t),a=n.get("buyer")?.value,m=n.get("utilisationOrderNo")?.value;this.api.GetApi(`/filtersapi/orders-styles?buyer=${a}&orderNo=${m}&`).subscribe(d=>{n.get("styleList")?.setValue(d.styles||[])})}loadColor(t){let n=this.orderAllocationForm.get("data").at(t),a=n.get("buyer")?.value,m=n.get("utilisationOrderNo")?.value,d=n.get("style")?.value;this.api.GetApi(`/filtersapi/styles-colors?buyer=${a}&orderNo=${m}&style=${d}&`).subscribe(C=>{n.get("colorList")?.setValue(C.colors||[])})}};E.\u0275fac=function(e){return new(e||E)(N(M),N(Ae),N(ke),N(R))},E.\u0275cmp=V({type:E,selectors:[["app-line-yarn"]],decls:131,vars:15,consts:[["d","ngbDatepicker"],["d01","ngbDatepicker"],["LotCheck",""],["orderAllocation",""],["item0","cAccordionItem"],["d02","ngbDatepicker"],["fluid",""],[3,"routerLink"],[1,"ms-auto"],["cButton","","color","primary","variant","outline",3,"click"],["fluid","",3,"formGroup"],[1,"container"],[1,"row","g-5"],[1,"accordion-body"],[1,"row","g-3","mb-4"],[1,"col-sm"],["cInputGroupText",""],["aria-label","Spin Fty","cSelect","","formControlName","spinner"],[3,"value",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","row","width","inherit"],[2,"width","100%"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","","container","body","formControlName","lcDate",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"cil-calendar"],["aria-label","LC no","cFormControl","","formControlName","lcNo"],["aria-label","PI","cFormControl","","formControlName","pi"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","","container","body","formControlName","piDate",1,"form-control"],["aria-label","LC Yarn Kgs","cFormControl","","readonly","","formControlName","lcYarnKgs"],["aria-label","LC Value","cFormControl","","readonly","","formControlName","lcValue"],["aria-label","Status","cSelect","","formControlName","yarnStatus"],["value","open"],["value","close"],["formArrayName","data"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"bg-light","text-center","p-2"],["cButton","","color","primary",3,"click"],["id","lotCheckModal","backdrop","static","scrollable","",3,"fullscreen"],["fluid","",1,"d-flex","justify-content-between","align-items-center","py-2"],["routerLink","/",1,"fw-bold","fs-5"],[1,"cil-plus","me-1"],["cButtonClose","",3,"cModalToggle"],["class","row g-5",4,"ngIf"],["class","d-flex justify-content-center align-items-center","style","height: 100vh; width: 100%;",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"w-100","text-center"],["cButton","","color","primary",3,"click",4,"ngIf"],["id","orderAllocationModal","backdrop","static","scrollable","",3,"fullscreen"],[3,"value"],[3,"formGroupName"],[3,"visible"],["cTemplateId","accordionHeaderTemplate"],["cTemplateId","accordionBodyTemplate"],["cAccordionButton","",3,"click","collapsed"],[4,"ngIf"],["aria-label","Yarn Type","cSelect","","formControlName","yarnType"],["aria-label","LC Yarn Kgs","cFormControl","","type","number","formControlName","lcYarnKgs"],["aria-label","Yarn Rate","cFormControl","","type","number","formControlName","yarnRate"],["aria-label","LC Value","cFormControl","","readonly","","formControlName","yarnValue"],[1,"row","g-3","mb-12"],[1,"text-center",2,"display","flex","gap","1vh"],["cButton","","color","primary","variant","outline",3,"click","cModalToggle"],[1,"text-center"],["cButton","","color","link",2,"color","red",3,"click"],["size","xl","title","List Icon",3,"cIcon"],["aria-label","Yarn Type","cFormControl","","type","text","formControlName","yarnType"],["aria-label","Lot no","cFormControl","","type","text","formControlName","lotNo"],["placeholder","yyyy-mm-dd","name","d01","ngbDatepicker","","container","body","formControlName","sampleDate",1,"form-control"],["placeholder","yyyy-mm-dd","name","dp02","ngbDatepicker","","container","body","formControlName","resultDate",1,"form-control"],["aria-label","Results","cFormControl","","formControlName","checkResults"],[1,"col-sm","d-flex","align-items-center"],[1,"input-group-text"],["type","checkbox","formControlName","acceptRejectStatus",1,"form-check-input","mt-0"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100vh","width","100%"],[2,"max-width","400px","text-align","center"],["cCardImg","top","src","../../../../assets/No data-amico.svg","alt","No Data"],["cCardTitle",""],["cCardText",""],["aria-label","Buyer","cSelect","","formControlName","buyer",3,"change"],["aria-label","Order No","cSelect","","formControlName","utilisationOrderNo",3,"change"],["aria-label","Style","cSelect","","formControlName","style",3,"change"],["aria-label","Color","cSelect","","formControlName","colour"],["aria-label","Lot No","cSelect","","formControlName","lotNo"],["aria-label","Allocated Yarn Kgs","cFormControl","","type","number","formControlName","allocatedYarnKgs"],["aria-label","Unallocated Yarn Kgs","cFormControl","","type","text","formControlName","unallocatedYarnKgs"]],template:function(e,n){if(e&1){let a=S();o(0,"div")(1,"c-header")(2,"c-container",6)(3,"c-header-brand",7),l(4,"Line Yarn"),i(),o(5,"c-header-nav",8)(6,"c-nav-item")(7,"button",9),f("click",function(){return y(a),g(n.AddLines())}),l(8,"Add"),i()()()(),u(9,"c-header-divider"),o(10,"c-container",10)(11,"div",11)(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"c-input-group")(17,"span",16),l(18,"Spin Fty"),i(),o(19,"select",17)(20,"option"),l(21,"Select"),i(),h(22,Ue,2,3,"option",18),i()()(),o(23,"div",15)(24,"c-input-group")(25,"div",19)(26,"div")(27,"span",16),l(28,"LC Date"),i()(),o(29,"div",20)(30,"div",21),u(31,"input",22,0),o(33,"button",23),f("click",function(){y(a);let d=x(32);return g(d.toggle())}),u(34,"i",24),i()()()()()(),o(35,"div",15)(36,"c-input-group")(37,"span",16),l(38,"LC no"),i(),u(39,"input",25),i()()(),o(40,"div",14)(41,"div",15)(42,"c-input-group")(43,"span",16),l(44,"PI"),i(),u(45,"input",26),i()(),o(46,"div",15)(47,"c-input-group")(48,"div",19)(49,"div")(50,"span",16),l(51,"PI Date"),i()(),o(52,"div",20)(53,"div",21),u(54,"input",27,1),o(56,"button",23),f("click",function(){y(a);let d=x(55);return g(d.toggle())}),u(57,"i",24),i()()()()()(),o(58,"div",15)(59,"c-input-group")(60,"span",16),l(61,"LC Yarn Kgs"),i(),u(62,"input",28),i()()(),o(63,"div",14)(64,"div",15)(65,"c-input-group")(66,"span",16),l(67,"LC Value"),i(),u(68,"input",29),i()(),o(69,"div",15)(70,"c-input-group")(71,"span",16),l(72,"Status"),i(),o(73,"select",30)(74,"option"),l(75,"Select"),i(),o(76,"option",31),l(77,"Open"),i(),o(78,"option",32),l(79,"Close"),i()()()()()()(),o(80,"div",12)(81,"div",33),h(82,et,6,2,"div",34),i()()()()(),o(83,"footer",35)(84,"div",8)(85,"button",36),f("click",function(){return y(a),g(n.updateYarn())}),l(86," Update changes "),i()()()(),o(87,"c-modal",37,2)(89,"c-modal-header")(90,"c-container",38)(91,"c-header-brand",39),l(92," Lot Check "),i(),o(93,"c-header-nav")(94,"c-nav-item")(95,"button",9),f("click",function(){return y(a),g(n.AddLotCheck())}),u(96,"i",40),l(97," Add "),i(),u(98,"button",41),i()()()(),o(99,"c-modal-body")(100,"div")(101,"c-header")(102,"c-container",10)(103,"div",11),h(104,pt,3,1,"div",42)(105,mt,8,0,"div",43),i()()()()(),o(106,"c-modal-footer",44)(107,"div",45),h(108,st,2,0,"button",46),i()()(),o(109,"c-modal",47,3)(111,"c-modal-header")(112,"c-container",38)(113,"c-header-brand",39),l(114," Order Allocation "),i(),o(115,"c-header-nav")(116,"c-nav-item")(117,"button",9),f("click",function(){return y(a),g(n.AddOrderAllocation())}),u(118,"i",40),l(119," Add "),i(),u(120,"button",41),i()()()(),o(121,"c-modal-body")(122,"div")(123,"c-header")(124,"c-container",10)(125,"div",11),h(126,Nt,3,1,"div",42)(127,Ft,8,0,"div",43),i()()()()(),o(128,"c-modal-footer",44)(129,"div",45),h(130,At,2,0,"button",46),i()()()}if(e&2){let a=x(88),m=x(110);c(10),p("formGroup",n.newYarnForm),c(12),p("ngForOf",n.spinFtyList),c(60),p("ngForOf",n.items.controls),c(5),p("fullscreen",!0),c(11),p("cModalToggle",a.id),c(4),p("formGroup",n.lotCheckForm),c(2),p("ngIf",((n.itemsLotCheck==null?null:n.itemsLotCheck.length)||0)>0),c(),p("ngIf",((n.itemsLotCheck==null?null:n.itemsLotCheck.length)||0)===0),c(3),p("ngIf",((n.itemsLotCheck==null?null:n.itemsLotCheck.length)||0)>0),c(),p("fullscreen",!0),c(11),p("cModalToggle",m.id),c(4),p("formGroup",n.orderAllocationForm),c(2),p("ngIf",((n.itemsOrderAllocation==null?null:n.itemsOrderAllocation.length)||0)>0),c(),p("ngIf",((n.itemsOrderAllocation==null?null:n.itemsOrderAllocation.length)||0)===0),c(3),p("ngIf",((n.itemsOrderAllocation==null?null:n.itemsOrderAllocation.length)||0)>0)}},dependencies:[B,J,Q,ee,Z,W,me,ae,le,ce,pe,Be,H,q,oe,se,j,z,de,ye,_e,ve,ue,Ie,Ne,Fe,he,be,fe,Ee,Ce,xe,Se,Te,Le,Ye,ne,ie,re,te,G,K,$,Ge,$e,Ke,we,Oe,Ve,De,U,P,X,Me,Re],encapsulation:2});var qe=E;export{qe as LineYarnComponent};
